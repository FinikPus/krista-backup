Tar и Zip
=========

Archiver
--------

Действие, которое выполняет архивацию файлов. Родительский класс
:ref:`tar <tar>` и :ref:`zip <zip>`. 

Для архива создаётся ``shapshot list``, который содержит путь
к соответствующему архиву и хранит для каждого файла время
изменения, размер и имя.

Файл добавляется в инкрементальный бэкап, если он не был создан
или у старого файла было изменено время изменения/размер.

.. csv-table:: 
   :widths: 15, 30, 20
   :header: "название", "описание", "значение"

    "basename", "Уникальное имя для связанных действий. Не должно быть началом другого basename, используется для имени результата.", "пример: названия последних двух папок, например home_user, var_log, etc"
    "check_level_list_only","Проверять только наличие list-файла при создании разностной копии (не проверять наличие архива).", "false (стандартное значение)"
    "checksum_file", "Создать файл с SHA1 хэшсуммой", "false (стандартное значение)"
    "exclusions","Список паттернов для файлов, которые стоит игнорировать.", "[ ]"
    "use_re_in_patterns","Использовать регулярные выражения (или unix wildcard).", "false (стандартное значение)"
    "compression","Уровень сжатия.", "5 (стандартное значение)"
    "src_path","Каталог, бэкап которого нужно выполнить.", "путь к директории"
    "dest_path","Каталог для файлов с результатом.", "путь к директории"
    "level","Уровень бэкапа.", "0 (стандартное значение, число)"
    "level_folders","Название подкаталогов для уровней. Если список пустой, то бэкапы делаются в dest_path.", "[ ]"
    "use_absolute_path","Использовать относительные пути (или абсолютные).", "false (стандартное значение)"
    "list_extension","Расширение snapshot листа.", "list (стандартное значение, строка)"
    "dry", "Не создавать архив (dryrun).", "false (стандартное значение)"
    "log_files","Логировать добавленные и исключенные из бэкапа файлы.", "false (стандартное значение)"


.. _tar:

Tar
---

Создаёт архив в формате ``tar.gz``, ``tar.bz2`` или ``tar.xz``.

.. csv-table:: 
   :widths: 15, 30, 20
   :header: "название", "описание", "значение"

    "compression_lib", "Метод сжатия.", "gzip (стандартное значение), bzip или lzma"
    "type", "Тип действия.", "tar"

Пример:
~~~~~~~

.. code-block:: yaml

  tarjob_0level_etc:
    basename: etc
    exclusions: '*/index/*, logs/archived/.indexed'
    src_path: /etc
    dest_path: /backup
    level: 0
    level_folders: ['0', '1']
    descr: бэкап файлов /etc 0-го уровня
    type: tar

.. _zip:

Zip
---

Создаёт архив в формате ``zip``, ``bz2`` или ``xz``.

.. csv-table:: 
   :widths: 15, 30, 20
   :header: "название", "описание", "значение"

    "compression_lib", "Метод сжатия.", "zip (стандартное значение), bzip или lzma"
    "type", "Тип действия.", "zip"


Пример:
~~~~~~~

.. code-block:: yaml

  zip_apt_0:
    basename: etc_apt
    check_level_list_only: true
    compression: 7
    exclusions: 'backup/.*, trusted.gpg.d/.*'
    use_re_in_patterns: true
    src_path: /etc/apt
    dest_path: /backup
    level: 0
    level_folders: ['0', '1']
    descr: бэкап файлов /etc/apt 0-го уровня
    type: zip

  
Примечание:
~~~~~~~~~~~

Реализованы только 0 и 1 уровень бэкапа.